<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Not My Dream Job</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const MOODS = [
            { id: 'furious', emoji: 'üò§', label: "I'm furious", color: 'bg-red-100 border-red-300' },
            { id: 'drained', emoji: 'üòû', label: "I'm drained", color: 'bg-blue-100 border-blue-300' },
            { id: 'numb', emoji: 'üòê', label: "Just numb", color: 'bg-gray-100 border-gray-300' },
            { id: 'laughcry', emoji: 'ü§°', label: "If I don't laugh, I'll cry", color: 'bg-purple-100 border-purple-300' },
            { id: 'sos', emoji: 'üÜò', label: "Something bad happened", color: 'bg-orange-100 border-orange-300' }
        ];

        const SECTORS = [
            'NHS', 'Retail', 'Hospitality', 'Tech', 'Education', 
            'Finance', 'Construction', 'Care Work', 'Office/Admin', 'Other'
        ];

        const TAGS = [
            'Burnout', 'Micromanagement', 'Unpaid Overtime', 'Harassment',
            'Toxic Boss', 'Understaffed', 'Bad Pay', 'No Work-Life Balance',
            'Bullying', 'Unfair Treatment', 'Constructive Dismissal', 'Discrimination'
        ];

        const REACTIONS = [
            { id: 'same', label: 'Same.', emoji: 'ü§ù' },
            { id: 'flag', label: 'üö© That's not okay', emoji: 'üö©' },
            { id: 'solidarity', label: 'Solidarity', emoji: 'üí™' },
            { id: 'helpful', label: 'This helped me', emoji: 'üí°' }
        ];

        const RIGHTS_LIBRARY = [
            {
                id: 'unfair-dismissal',
                title: 'Unfair Dismissal Basics',
                content: 'In the UK, you generally need 2 years of service to claim unfair dismissal (with some exceptions like discrimination or whistleblowing). Your employer must follow a fair procedure and have a valid reason. Not legal advice‚Äîspeak to ACAS or a solicitor if this is happening to you.',
                tags: ['Unfair Treatment', 'Constructive Dismissal']
            },
            {
                id: 'constructive-dismissal',
                title: 'Constructive Dismissal Overview',
                content: 'This is when your employer makes your working conditions so intolerable that you feel forced to resign. Examples: major pay cuts without agreement, demotion, persistent bullying. You usually need to resign quickly after the breach and have 2 years service. Document everything. Get advice before resigning.',
                tags: ['Constructive Dismissal', 'Toxic Boss', 'Bullying']
            },
            {
                id: 'unpaid-overtime',
                title: 'Pay & Working Hours',
                content: 'Your employer can't pay you below minimum wage. Check if your contract says overtime is unpaid. Working Time Regulations limit you to 48 hours/week average (unless you opt out). If you're doing unpaid work that brings you below minimum wage per hour worked, that's illegal.',
                tags: ['Unpaid Overtime', 'Bad Pay']
            },
            {
                id: 'harassment',
                title: 'Harassment & Discrimination',
                content: 'Harassment related to protected characteristics (age, disability, gender, race, religion, sexual orientation, etc.) is illegal. Your employer must take complaints seriously and protect you. Keep records of incidents, witnesses, and any reports you make. Contact ACAS or a specialist employment solicitor.',
                tags: ['Harassment', 'Discrimination', 'Bullying']
            }
        ];

        const SAMPLE_POSTS = [
            {
                id: 1,
                body: "Three people left last month. They haven't replaced anyone. Now I'm doing two jobs for the same pay and my manager acts like I should be grateful for the 'opportunity to grow'.",
                mood: 'furious',
                tags: ['Understaffed', 'Unpaid Overtime', 'Toxic Boss'],
                sector: 'Retail',
                timestamp: Date.now() - 3600000,
                reactions: { same: 12, flag: 3, solidarity: 8, helpful: 0 },
                comments: [
                    { id: 101, body: "This exact thing happened in my last place. Document everything‚Äîespecially if they're asking you to do tasks outside your job description.", user: 'TiredOtter421' }
                ]
            },
            {
                id: 2,
                body: "Got pulled into a 'performance review' with zero notice. Turns out they're building a case to get rid of me after I complained about my team lead's behaviour. Classic.",
                mood: 'drained',
                tags: ['Bullying', 'Unfair Treatment', 'Constructive Dismissal'],
                sector: 'Office/Admin',
                timestamp: Date.now() - 7200000,
                reactions: { same: 18, flag: 15, solidarity: 6, helpful: 2 },
                comments: []
            },
            {
                id: 3,
                body: "They scheduled a 'mandatory fun' team building day on my day off. Unpaid, obviously. When I said I couldn't make it they said it showed lack of commitment.",
                mood: 'laughcry',
                tags: ['No Work-Life Balance', 'Toxic Boss'],
                sector: 'Tech',
                timestamp: Date.now() - 10800000,
                reactions: { same: 24, flag: 5, solidarity: 11, helpful: 1 },
                comments: []
            }
        ];

        function App() {
            const [view, setView] = useState('mood-check');
            const [userMood, setUserMood] = useState(null);
            const [userSector, setUserSector] = useState(null);
            const [posts, setPosts] = useState(SAMPLE_POSTS);
            const [currentPost, setCurrentPost] = useState(null);
            const [newPostBody, setNewPostBody] = useState('');
            const [selectedTags, setSelectedTags] = useState([]);
            const [selectedMood, setSelectedMood] = useState(null);
            const [showSafetyCheck, setShowSafetyCheck] = useState(false);
            const [filterMood, setFilterMood] = useState(null);
            const [showLibrary, setShowLibrary] = useState(false);

            const handleMoodSelect = (mood) => {
                setUserMood(mood);
                setView('sector');
            };

            const handleSectorSelect = (sector) => {
                setUserSector(sector);
                setView('safety-promise');
            };

            const handleStartApp = (action) => {
                if (action === 'vent') {
                    setView('compose');
                } else {
                    setView('feed');
                }
            };

            const detectProblematicContent = (text) => {
                const patterns = [
                    /Ltd\.?/i, /PLC/i, /LLP/i,
                    /@\w+\.co\.uk/i,
                    /\b[A-Z][a-z]+ [A-Z][a-z]+\b/,
                    /\d{11}/, /\d{3}[- ]?\d{4}[- ]?\d{4}/
                ];
                return patterns.some(pattern => pattern.test(text));
            };

            const handlePostSubmit = () => {
                if (detectProblematicContent(newPostBody)) {
                    setShowSafetyCheck(true);
                    return;
                }
                submitPost();
            };

            const submitPost = () => {
                const newPost = {
                    id: Date.now(),
                    body: newPostBody,
                    mood: selectedMood || userMood,
                    tags: selectedTags,
                    sector: userSector,
                    timestamp: Date.now(),
                    reactions: { same: 0, flag: 0, solidarity: 0, helpful: 0 },
                    comments: []
                };
                setPosts([newPost, ...posts]);
                setNewPostBody('');
                setSelectedTags([]);
                setSelectedMood(null);
                setShowSafetyCheck(false);
                setView('feed');
            };

            const toggleTag = (tag) => {
                if (selectedTags.includes(tag)) {
                    setSelectedTags(selectedTags.filter(t => t !== tag));
                } else if (selectedTags.length < 3) {
                    setSelectedTags([...selectedTags, tag]);
                }
            };

            const addReaction = (postId, reactionType) => {
                setPosts(posts.map(post => {
                    if (post.id === postId) {
                        return {
                            ...post,
                            reactions: {
                                ...post.reactions,
                                [reactionType]: post.reactions[reactionType] + 1
                            }
                        };
                    }
                    return post;
                }));
            };

            const formatTimeAgo = (timestamp) => {
                const minutes = Math.floor((Date.now() - timestamp) / 60000);
                if (minutes < 60) return `${minutes}m ago`;
                const hours = Math.floor(minutes / 60);
                if (hours < 24) return `${hours}h ago`;
                return `${Math.floor(hours / 24)}d ago`;
            };

            const filteredPosts = filterMood 
                ? posts.filter(p => p.mood === filterMood)
                : posts;

            // Mood Check View
            if (view === 'mood-check') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-slate-900 to-slate-800 text-white p-6 flex flex-col items-center justify-center">
                        <div className="max-w-md w-full">
                            <h1 className="text-3xl font-bold mb-2 text-center">Not My Dream Job</h1>
                            <p className="text-slate-300 text-center mb-8">A safe place before your next move</p>
                            
                            <div className="bg-slate-800 rounded-lg p-6 mb-6">
                                <h2 className="text-xl mb-6 text-center">How bad is today?</h2>
                                <div className="space-y-3">
                                    {MOODS.map(mood => (
                                        <button
                                            key={mood.id}
                                            onClick={() => handleMoodSelect(mood.id)}
                                            className={`w-full p-4 rounded-lg border-2 ${mood.color} text-slate-800 font-medium flex items-center justify-between hover:shadow-lg transition`}
                                        >
                                            <span>{mood.label}</span>
                                            <span className="text-2xl">{mood.emoji}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Sector Selection
            if (view === 'sector') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-slate-900 to-slate-800 text-white p-6 flex flex-col items-center justify-center">
                        <div className="max-w-md w-full">
                            <h2 className="text-2xl mb-4 text-center">What sector? (Optional)</h2>
                            <p className="text-slate-300 text-sm mb-6 text-center">Helps us show you relevant posts</p>
                            
                            <div className="grid grid-cols-2 gap-3 mb-4">
                                {SECTORS.map(sector => (
                                    <button
                                        key={sector}
                                        onClick={() => handleSectorSelect(sector)}
                                        className="p-3 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition"
                                    >
                                        {sector}
                                    </button>
                                ))}
                            </div>
                            
                            <button
                                onClick={() => handleSectorSelect(null)}
                                className="w-full p-3 text-slate-400 hover:text-white transition"
                            >
                                Skip
                            </button>
                        </div>
                    </div>
                );
            }

            // Safety Promise
            if (view === 'safety-promise') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-slate-900 to-slate-800 text-white p-6 flex flex-col items-center justify-center">
                        <div className="max-w-md w-full bg-slate-800 rounded-lg p-8">
                            <h2 className="text-2xl mb-6 text-center">You're anonymous here</h2>
                            
                            <div className="space-y-4 mb-8 text-slate-300">
                                <p>‚úì No real names</p>
                                <p>‚úì No employers shown publicly</p>
                                <p>‚úì You control what happens next</p>
                            </div>
                            
                            <div className="space-y-3">
                                <button
                                    onClick={() => handleStartApp('vent')}
                                    className="w-full p-4 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition"
                                >
                                    I need to vent
                                </button>
                                <button
                                    onClick={() => handleStartApp('read')}
                                    className="w-full p-4 bg-slate-700 hover:bg-slate-600 rounded-lg transition"
                                >
                                    I just want to read
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Compose View
            if (view === 'compose') {
                return (
                    <div className="min-h-screen bg-slate-900 text-white">
                        <div className="max-w-2xl mx-auto p-4">
                            <div className="flex items-center justify-between mb-6">
                                <button onClick={() => setView('feed')} className="text-slate-400 hover:text-white">
                                    ‚Üê Back
                                </button>
                                <h1 className="text-xl font-bold">Post a Rant</h1>
                                <div className="w-16"></div>
                            </div>

                            <div className="bg-slate-800 rounded-lg p-4 mb-4">
                                <textarea
                                    value={newPostBody}
                                    onChange={(e) => setNewPostBody(e.target.value)}
                                    placeholder="What finally pushed you today?"
                                    className="w-full bg-slate-900 text-white p-4 rounded-lg min-h-40 resize-none focus:outline-none focus:ring-2 focus:ring-slate-600"
                                    maxLength={1500}
                                />
                                <div className="text-right text-sm text-slate-400 mt-2">
                                    {newPostBody.length}/1500
                                </div>
                            </div>

                            <div className="bg-slate-800 rounded-lg p-4 mb-4">
                                <label className="block text-sm text-slate-400 mb-3">How are you feeling?</label>
                                <div className="grid grid-cols-2 gap-2">
                                    {MOODS.map(mood => (
                                        <button
                                            key={mood.id}
                                            onClick={() => setSelectedMood(mood.id)}
                                            className={`p-3 rounded-lg border-2 transition ${
                                                selectedMood === mood.id 
                                                    ? 'border-white bg-slate-700' 
                                                    : 'border-slate-700 hover:border-slate-600'
                                            }`}
                                        >
                                            <span className="mr-2">{mood.emoji}</span>
                                            <span className="text-sm">{mood.label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-slate-800 rounded-lg p-4 mb-4">
                                <label className="block text-sm text-slate-400 mb-3">
                                    Tags (pick up to 3)
                                </label>
                                <div className="flex flex-wrap gap-2">
                                    {TAGS.map(tag => (
                                        <button
                                            key={tag}
                                            onClick={() => toggleTag(tag)}
                                            className={`px-3 py-1.5 rounded-full text-sm transition ${
                                                selectedTags.includes(tag)
                                                    ? 'bg-red-600 text-white'
                                                    : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                            }`}
                                        >
                                            {tag}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-amber-900/30 border border-amber-600/50 rounded-lg p-4 mb-4">
                                <p className="text-sm text-amber-200">
                                    ‚ö†Ô∏è Don't include names, company details, or identifying information
                                </p>
                            </div>

                            <button
                                onClick={handlePostSubmit}
                                disabled={!newPostBody.trim() || newPostBody.length < 10}
                                className="w-full p-4 bg-red-600 hover:bg-red-700 disabled:bg-slate-700 disabled:text-slate-500 rounded-lg font-medium transition"
                            >
                                Post Anonymously
                            </button>

                            {showSafetyCheck && (
                                <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
                                    <div className="bg-slate-800 rounded-lg p-6 max-w-md">
                                        <h3 className="text-xl font-bold mb-4">Quick safety check</h3>
                                        <p className="text-slate-300 mb-6">
                                            Looks like you may have included identifying info (names, company, email, phone). 
                                            This helps protect you and others. Want to edit?
                                        </p>
                                        <div className="space-y-3">
                                            <button
                                                onClick={() => setShowSafetyCheck(false)}
                                                className="w-full p-3 bg-slate-700 hover:bg-slate-600 rounded-lg"
                                            >
                                                Let me edit
                                            </button>
                                            <button
                                                onClick={submitPost}
                                                className="w-full p-3 text-slate-400 hover:text-white"
                                            >
                                                Post anyway
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Rights Library
            if (showLibrary) {
                return (
                    <div className="min-h-screen bg-slate-900 text-white">
                        <div className="max-w-2xl mx-auto p-4">
                            <div className="flex items-center justify-between mb-6">
                                <button onClick={() => setShowLibrary(false)} className="text-slate-400 hover:text-white">
                                    ‚Üê Back
                                </button>
                                <h1 className="text-xl font-bold">Is This Normal?</h1>
                                <div className="w-16"></div>
                            </div>

                            <div className="bg-amber-900/30 border border-amber-600/50 rounded-lg p-4 mb-6">
                                <p className="text-sm text-amber-200">
                                    ‚ÑπÔ∏è This is general information, not legal advice. Contact ACAS or a solicitor for your specific situation.
                                </p>
                            </div>

                            <div className="space-y-4">
                                {RIGHTS_LIBRARY.map(item => (
                                    <div key={item.id} className="bg-slate-800 rounded-lg p-4">
                                        <h3 className="font-bold mb-2">{item.title}</h3>
                                        <p className="text-slate-300 text-sm mb-3">{item.content}</p>
                                        <div className="flex flex-wrap gap-2">
                                            {item.tags.map(tag => (
                                                <span key={tag} className="px-2 py-1 bg-slate-700 rounded text-xs">
                                                    {tag}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // Post Detail View
            if (currentPost) {
                const post = posts.find(p => p.id === currentPost);
                const postMood = MOODS.find(m => m.id === post.mood);

                return (
                    <div className="min-h-screen bg-slate-900 text-white">
                        <div className="max-w-2xl mx-auto p-4">
                            <div className="flex items-center justify-between mb-6">
                                <button onClick={() => setCurrentPost(null)} className="text-slate-400 hover:text-white">
                                    ‚Üê Back
                                </button>
                                <div className="w-16"></div>
                            </div>

                            <div className="bg-slate-800 rounded-lg p-4 mb-4">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="flex items-center gap-2">
                                        <span className="text-2xl">{postMood.emoji}</span>
                                        <span className="text-sm text-slate-400">{post.sector}</span>
                                    </div>
                                    <span className="text-sm text-slate-400">{formatTimeAgo(post.timestamp)}</span>
                                </div>

                                <p className="text-slate-100 mb-4">{post.body}</p>

                                <div className="flex flex-wrap gap-2 mb-4">
                                    {post.tags.map(tag => (
                                        <span key={tag} className="px-2 py-1 bg-slate-700 rounded-full text-xs">
                                            {tag}
                                        </span>
                                    ))}
                                </div>

                                <div className="flex gap-4 pt-4 border-t border-slate-700">
                                    {REACTIONS.map(reaction => (
                                        <button
                                            key={reaction.id}
                                            onClick={() => addReaction(post.id, reaction.id)}
                                            className="flex items-center gap-1 text-sm text-slate-400 hover:text-white transition"
                                        >
                                            <span>{reaction.emoji}</span>
                                            <span>{post.reactions[reaction.id]}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="space-y-4">
                                {post.comments.map(comment => (
                                    <div key={comment.id} className="bg-slate-800 rounded-lg p-4">
                                        <div className="flex items-center gap-2 mb-2">
                                            <span className="text-sm text-slate-400">{comment.user}</span>
                                        </div>
                                        <p className="text-slate-200 text-sm">{comment.body}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // Feed View
            return (
                <div className="min-h-screen bg-slate-900 text-white">
                    <div className="max-w-2xl mx-auto">
                        {/* Header */}
                        <div className="sticky top-0 bg-slate-900 border-b border-slate-800 p-4 z-10">
                            <div className="flex items-center justify-between mb-4">
                                <h1 className="text-xl font-bold">Not My Dream Job</h1>
                                <button
                                    onClick={() => setShowLibrary(true)}
                                    className="text-sm bg-slate-800 px-3 py-1.5 rounded-lg hover:bg-slate-700"
                                >
                                    Is this normal?
                                </button>
                            </div>

                            {/* Mood Filter */}
                            <div className="flex gap-2 overflow-x-auto pb-2">
                                <button
                                    onClick={() => setFilterMood(null)}
                                    className={`px-3 py-1.5 rounded-full text-sm whitespace-nowrap ${
                                        !filterMood ? 'bg-white text-slate-900' : 'bg-slate-800 text-slate-300'
                                    }`}
                                >
                                    All
                                </button>
                                {MOODS.map(mood => (
                                    <button
                                        key={mood.id}
                                        onClick={() => setFilterMood(mood.id)}
                                        className={`px-3 py-1.5 rounded-full text-sm whitespace-nowrap ${
                                            filterMood === mood.id ? 'bg-white text-slate-900' : 'bg-slate-800 text-slate-300'
                                        }`}
                                    >
                                        {mood.emoji} {mood.label.replace("I'm ", "").replace("If I don't laugh, I'll cry", "Laugh/cry")}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Posts */}
                        <div className="p-4 space-y-4">
                            {filteredPosts.map(post => {
                                const postMood = MOODS.find(m => m.id === post.mood);
                                return (
                                    <div key={post.id} className="bg-slate-800 rounded-lg p-4">
                                        <div className="flex items-center justify-between mb-3">
                                            <div className="flex items-center gap-2">
                                                <span className="text-2xl">{postMood.emoji}</span>
                                                <span className="text-sm text-slate-400">{post.sector}</span>
                                            </div>
                                            <span className="text-sm text-slate-400">{formatTimeAgo(post.timestamp)}</span>
                                        </div>

                                        <p className="text-slate-100 mb-4">{post.body}</p>

                                        <div className="flex flex-wrap gap-2 mb-4">
                                            {post.tags.map(tag => (
                                                <span key={tag} className="px-2 py-1 bg-slate-700 rounded-full text-xs">
                                                    {tag}
                                                </span>
                                            ))}
                                        </div>

                                        <div className="flex gap-4 pt-4 border-t border-slate-700">
                                            {REACTIONS.map(reaction => (
                                                <button
                                                    key={reaction.id}
                                                    onClick={() => addReaction(post.id, reaction.id)}
                                                    className="flex items-center gap-1 text-sm text-slate-400 hover:text-white transition"
                                                >
                                                    <span>{reaction.emoji}</span>
                                                    <span>{post.reactions[reaction.id]}</span>
                                                </button>
                                            ))}
                                            {post.comments.length > 0 && (
                                                <button
                                                    onClick={() => setCurrentPost(post.id)}
                                                    className="ml-auto text-sm text-slate-400 hover:text-white"
                                                >
                                                    {post.comments.length} comment{post.comments.length !== 1 ? 's' : ''}
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {/* Floating Action Button */}
                        <button
                            onClick={() => setView('compose')}
                            className="fixed bottom-6 right-6 w-14 h-14 bg-red-600 hover:bg-red-700 rounded-full shadow-lg flex items-center justify-center text-2xl transition"
                        >
                            +
                        </button>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>